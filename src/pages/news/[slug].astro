---
import Layout from "~/layouts/PageLayout.astro";
import { getAllActualites } from "~/utils/api";

export async function getStaticPaths() {
  const articles = await getAllActualites();

  return articles.map((post: any) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;

const articles = await getAllActualites();
const article = articles.find((post: any) => post.slug === slug);

if (!article) {
  throw new Error("Article introuvable");
}

const metadata = {
  title: article.title,
};
---

<Layout metadata={metadata}>
  <main class="mx-auto py-16 bg-[#fcfcfc]">
    <div class="max-w-4xl mx-auto text-center mb-12 space-y-6">
      <span
        class="text-base font-semibold text-green-900 mb-2 border border-green-900 px-4 py-3 rounded-full"
        >{article.categories?.nodes?.[0]?.name}</span
      >
      <h2 class="text-5xl font-bold mb-6 text-green-900">
        {article.title}
      </h2>
      <p class="text-sm text-center text-green-900 mb-8">
        • Publié le {
          new Date(article.date).toLocaleDateString("fr-FR", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        }
      </p>
    </div>

    <div class="max-w-4xl mx-auto mb-12">
      {
        article.featuredImage?.node?.mediaItemUrl && (
          <div class="mb-8">
            <img
              src={article.featuredImage.node.mediaItemUrl}
              alt={article.featuredImage.node.altText ?? article.title}
              class="w-full h-auto rounded-lg"
            />
          </div>
        )
      }
      <!-- Contenu de l'article formaté -->
      <article
        class="prose prose-lg prose-green max-w-none
        prose-headings:text-green-900 prose-headings:font-bold
        prose-h2:text-3xl prose-h2:mt-12 prose-h2:mb-6
        prose-p:text-gray-700 prose-p:leading-relaxed prose-p:mb-6
        prose-ul:my-6 prose-ul:space-y-3
        prose-li:text-gray-700
        prose-strong:text-green-900 prose-strong:font-semibold"
      >
        <div set:html={article.content ?? article.excerpt} />
      </article>
    </div>
  </main>
</Layout>
