---
import Layout from '~/layouts/PageLayout.astro';
import { Image } from 'astro:assets';
import { Fragment } from 'astro/jsx-runtime';
import etapeProjetImage from '~/assets/images/lesetapes.png';
import defaultImg from '~/assets/images/default.png';
import projetcours from '~/assets/images/projetencours.png';

const metadata = {
  title: "Projets - AfricTivistes CitizenLab Sénégal",
  description: "Découvrez nos projets en cours, nos prototypes et nos impacts sur le terrain pour renforcer la participation citoyenne au Sénégal.",
  ignoreTitleTemplate: true,
};

// Données des projets selon le design Figma
// Vous pouvez ajouter autant de projets que nécessaire ici
const projets = [
  {
    id: 1,
    titre: "Plateforme de Participation Rurale",
    description: "Un outil numérique permettant aux citoyens des zones rurales de contribuer à la prise de décision locale et de suivre les projets communautaires.",
    categorie: "Participation",
    statut: "En cours",
    statutDetail: "en phase de test",
    image: defaultImg,
    imagePosition: "left", // borderRadius: 47px 0px 0px 0px
  },
  {
    id: 2,
    titre: "Programme Jeunes Innovateurs Civiques",
    description: "Formation et accompagnement de 300 jeunes en innovation, data citoyenne, leadership communautaire et prototypage de solutions.",
    categorie: "Innovation",
    statut: "En cours",
    statutDetail: "Co-conception",
    image: defaultImg,
    imagePosition: "right", // borderRadius: 0px 47px 0px 0px
  },
  {
    id: 3,
    titre: "Observatoire de la Transparence Publique",
    description: "Plateforme de suivi et d'analyse des données publiques pour améliorer la transparence et la redevabilité des institutions.",
    categorie: "Transparence",
    statut: "En cours",
    statutDetail: "Co-conception",
    image: defaultImg,
    imagePosition: "left",
  },
  // Ajoutez plus de projets ici si nécessaire
  // Exemple :
  // {
  //   id: 4,
  //   titre: "Nouveau Projet",
  //   description: "Description du nouveau projet...",
  //   categorie: "Environnement",
  //   statut: "En cours",
  //   statutDetail: "Prototypage",
  //   image: defaultImg,
  //   imagePosition: "right",
  // },
];

// Configuration de la pagination (optionnel)
const projetsParPage = 6; // Nombre de projets à afficher par page
const pageActuelle = 1; // Page actuelle (peut être dynamique)

// Alterner automatiquement la position des images si non spécifiée
const projetsAvecPosition = projets.map((projet, index) => ({
  ...projet,
  imagePosition: projet.imagePosition || (index % 2 === 0 ? "left" : "right")
}));

const projetsAffiches = projetsAvecPosition; // Afficher tous les projets pour l'instant

// Étapes du projet selon le design Figma
const etapes = [
  "Exploration",
  "Co-conception",
  "Prototypage",
  "Test sur le terrain",
  "Amélioration",
  "Pré-déploiement",
];
---

<Layout metadata={metadata}>
  <!-- Hero Banner avec image de fond -->
  <section class="relative isolate overflow-hidden">
    <div class="absolute inset-0">
      <Image
        src={projetcours}
        alt="Bannière Projets"
        width={1920}
        height={800}
        class="h-full w-full object-cover"
      />
    </div>
    <div class="absolute inset-0 bg-gradient-to-r from-black/80 via-black/70 to-black/40"></div>
    
    <!-- Contenu de la bannière -->
    <div class="relative z-30 mx-auto flex max-w-7xl flex-col gap-6 px-4 py-32 text-white sm:px-6 lg:px-8">
      <p class="text-sm uppercase tracking-[0.3em] text-primary-light">Nos projets</p>
      <h1 class="text-4xl font-black leading-tight sm:text-5xl lg:text-6xl">
        Des solutions innovantes pour renforcer la participation citoyenne
      </h1>
      <p class="max-w-5xl text-lg text-slate-100 sm:text-xl">
        Chez CitizenLab, nous développons et expérimentons des solutions innovantes pour renforcer la participation 
        citoyenne, améliorer la transparence publique et favoriser la collaboration entre communautés, institutions 
        et acteurs sociaux.
      </p>
    </div>
  </section>

  <!-- Introduction Section -->
  <section class="bg-white py-8 sm:py-12">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <p class="text-xl md:text-2xl leading-relaxed text-black">
        Chez CitizenLab, nous développons et expérimentons des solutions innovantes pour renforcer la participation 
        citoyenne, améliorer la transparence publique et favoriser la collaboration entre communautés, institutions 
        et acteurs sociaux. Découvrez nos projets en cours, nos prototypes et nos impacts sur le terrain.
      </p>
    </div>
  </section>

  <!-- Étapes du projet Section -->
  <section class="bg-white py-8 sm:py-12">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <p class="text-xl md:text-2xl leading-relaxed text-black mb-6">
        Chaque projet passe par plusieurs étapes :
      </p>
      <div class="mb-6">
        <Image
          src={etapeProjetImage}
          alt="Étapes du projet"
          class="w-full h-auto"
        />
      </div>
      <div class="mt-6 flex flex-wrap items-center justify-center gap-2 sm:gap-3 md:gap-4">
        {etapes.map((etape, index) => (
          <Fragment>
            <span class="text-xs sm:text-sm md:text-base lg:text-lg xl:text-xl text-black leading-tight whitespace-nowrap">
              {etape}
            </span>
            {index < etapes.length - 1 && (
              <span class="text-xs sm:text-sm md:text-base lg:text-lg xl:text-xl text-black leading-tight">
                →
              </span>
            )}
          </Fragment>
        ))}
      </div>
    </div>
  </section>

  <!-- Projets en cours Section -->
  <section class="bg-gray-50 py-8 sm:py-12">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="mb-8">
        <h2 class="text-4xl font-bold text-black mb-3">Projets en cours</h2>
        <div class="h-1 w-32 bg-primary mb-4"></div>
        <p class="text-xl md:text-2xl text-black leading-relaxed">
          CitizenLab mène actuellement plusieurs projets pilotes, axés sur le numérique, la participation citoyenne, 
          l'environnement, la transparence publique et l'innovation sociale. Chaque projet est toujours en évolution 
          et inclut des phases de prototypage, de test et de validation avec les communautés.
        </p>
      </div>

      <!-- Grille des projets -->
      <div class="space-y-10">
        {projetsAffiches.map((projet, index) => (
          <div class="relative overflow-hidden rounded-lg bg-white shadow-lg my-4" style="border-radius: 7px;" data-projet-index={index}>
            <div class="flex flex-col lg:flex-row">
              <!-- Image du projet avec borderRadius spécifique selon position -->
              <div class={`relative h-64 lg:h-auto lg:w-1/2 overflow-hidden ${
                projet.imagePosition === "left" 
                  ? "rounded-tl-[47px]" 
                  : "rounded-tr-[47px] lg:order-2"
              }`}>
                <Image
                  src={projet.image}
                  alt={projet.titre}
                  width={600}
                  height={400}
                  class="h-full w-full object-cover"
                />
              </div>

              <!-- Contenu du projet -->
              <div class={`flex-1 p-8 bg-white ${
                projet.imagePosition === "left" 
                  ? "rounded-br-[47px] rounded-bl-[47px]" 
                  : "rounded-bl-[47px] rounded-br-[47px] lg:order-1"
              }`}>
                <!-- Badge catégorie -->
                <div class="mb-4">
                  <span class={`inline-flex items-center rounded-full px-4 py-2 text-base md:text-lg font-semibold ${
                    projet.categorie === "Participation" 
                      ? "bg-primary text-white" 
                      : "bg-[#FF6B35] text-white"
                  }`}>
                    {projet.categorie}
                  </span>
                </div>

                <!-- Titre -->
                <h3 class="text-3xl md:text-4xl font-bold text-black mb-4">{projet.titre}</h3>
                
                <!-- Description -->
                <p class="text-lg md:text-xl text-gray-700 mb-6 leading-relaxed">{projet.description}</p>

                <!-- Statut détaillé -->
                <p class="text-base md:text-lg text-gray-600 mb-6">Statut : {projet.statutDetail}</p>
                
                <!-- Badge "En cours" et bouton -->
                <div class="flex items-center gap-4 flex-wrap">
                  <div class="flex items-center gap-2">
                    <div class="h-8 w-8 rounded-full bg-primary flex items-center justify-center">
                      <span class="text-white font-bold">{projet.id}</span>
                    </div>
                    <span class="px-4 py-2 bg-white border-2 border-primary text-primary text-base md:text-lg font-semibold rounded-lg">
                      {projet.statut}
                    </span>
                  </div>
                  
                  <!-- Bouton Découvrir -->
                  <a
                    href={`/projets/${projet.id}`}
                    class="inline-flex items-center rounded-lg bg-white border-2 border-primary px-6 py-2 text-lg md:text-xl font-semibold text-primary transition-all duration-200 hover:bg-primary hover:text-white"
                    style="border-radius: 10px;"
                  >
                    Découvrir
                    <span class="ml-2">→</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- Pagination (affichée seulement si plus de projets que la limite) -->
      {projets.length > projetsParPage && (
        <div class="mt-12 flex justify-center items-center gap-4">
          <button 
            class="px-4 py-2 rounded-lg border-2 border-primary text-primary font-semibold hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            id="prevPage"
            disabled={pageActuelle === 1}
          >
            Précédent
          </button>
          
          <span class="text-gray-700 font-medium">
            Page {pageActuelle} sur {Math.ceil(projets.length / projetsParPage)}
          </span>
          
          <button 
            class="px-4 py-2 rounded-lg border-2 border-primary text-primary font-semibold hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            id="nextPage"
            disabled={pageActuelle >= Math.ceil(projets.length / projetsParPage)}
          >
            Suivant
          </button>
        </div>
      )}

      <!-- Message si aucun projet -->
      {projets.length === 0 && (
        <div class="text-center py-12">
          <p class="text-lg text-gray-600">Aucun projet disponible pour le moment.</p>
        </div>
      )}
    </div>
  </section>

</Layout>

<script>
  // Script pour gérer la pagination côté client (optionnel)
  // Pour activer la pagination, décommentez le code ci-dessous et modifiez projetsAffiches dans le frontmatter
  
  // document.addEventListener('DOMContentLoaded', function() {
  //   const prevButton = document.getElementById('prevPage');
  //   const nextButton = document.getElementById('nextPage');
  //   const projets = document.querySelectorAll('[data-projet-index]');
  //   let currentPage = 1;
  //   const itemsPerPage = 6;
  //   const totalPages = Math.ceil(projets.length / itemsPerPage);
  //
  //   function showPage(page) {
  //     const start = (page - 1) * itemsPerPage;
  //     const end = start + itemsPerPage;
  //     
  //     projets.forEach((projet, index) => {
  //       if (index >= start && index < end) {
  //         projet.style.display = 'block';
  //       } else {
  //         projet.style.display = 'none';
  //       }
  //     });
  //     
  //     if (prevButton) prevButton.disabled = page === 1;
  //     if (nextButton) nextButton.disabled = page >= totalPages;
  //   }
  //
  //   if (prevButton) {
  //     prevButton.addEventListener('click', () => {
  //       if (currentPage > 1) {
  //         currentPage--;
  //         showPage(currentPage);
  //       }
  //     });
  //   }
  //
  //   if (nextButton) {
  //     nextButton.addEventListener('click', () => {
  //       if (currentPage < totalPages) {
  //         currentPage++;
  //         showPage(currentPage);
  //       }
  //     });
  //   }
  //
  //   // Afficher la première page
  //   showPage(1);
  // });
</script>

<style>
  /* Styles spécifiques pour correspondre au design Figma */
  @font-face {
    font-family: 'Inknut Antiqua';
    font-style: normal;
    font-weight: 700;
    src: url('https://fonts.googleapis.com/css2?family=Inknut+Antiqua:wght@700&display=swap');
  }
</style>