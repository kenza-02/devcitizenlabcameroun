---
import { HiOutlineNewspaper } from "react-icons/hi";
import { FaArrowRightLong } from "react-icons/fa6";

import { getLatestActualites } from "~/utils/api";
import { getContentUrl } from "~/utils/contentRouting";
import { resolveContentType } from "~/utils/resolveContentType";

// R√©cup√©ration des 3 derniers contenus (actualit√©s, podcasts, vid√©os)
const posts = await getLatestActualites(3);

// Transformation WordPress ‚Üí UI
const newsItems = posts.map((post : any, index : any) => {
  const type = resolveContentType(post);

  return {
    // Libell√© affich√©
    typeLabel: post.categories?.nodes?.[0]?.name ?? "Actualit√©",

    title: post.title,

    description: post.excerpt?.replace(/<[^>]+>/g, ""),

    image: post.featuredImage?.node?.mediaItemUrl,
    alt: post.featuredImage?.node?.altText ?? post.title,

    // üîë LIEN CENTRALIS√â
    link: getContentUrl({
      slug: post.slug,
      type,
    }),

    variant:
      index === 1
        ? "split"
        : index === 2
        ? "overlay-light"
        : "overlay",

    large: index === 0,
    icon: FaArrowRightLong,
  };
});
---

<section class="py-20 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- Titre -->
    <div class="text-center mb-16">
      <div class="inline-block mb-6">
        <span class="px-5 py-2 border border-green-600 text-green-600 bg-white rounded-full text-xs font-semibold uppercase">
          News
        </span>
      </div>

      <h2 class="text-4xl md:text-5xl font-bold mb-4">
        Actualit√©s et <span class="text-green-600">m√©dias</span>
      </h2>

      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Restez inform√©s de nos derni√®res initiatives, √©v√©nements et succ√®s
      </p>
    </div>

    <!-- Grille -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
      {newsItems.map((item : any) =>
        item.variant === "split" ? (
          <!-- Carte split -->
          <article class="relative rounded-3xl overflow-hidden shadow-lg group bg-[#d4c9a8]">
            <div class="flex flex-col md:flex-row h-full">
              <div class="md:w-1/2 p-8 flex flex-col justify-between">
                <div>
                  <span class="text-sm font-semibold uppercase mb-4 block">
                    {item.typeLabel}
                  </span>
                  <h3 class="text-2xl font-bold mb-4">
                    {item.title}
                  </h3>
                </div>
                <a
                  href={item.link}
                  class="inline-flex items-center justify-center w-12 h-12 bg-green-700 rounded-full hover:bg-green-800"
                >
                  <item.icon className="w-5 h-5 text-white" />
                </a>
              </div>

              <div class="md:w-1/2 relative">
                <img
                  src={item.image}
                  alt={item.alt}
                  class="w-full h-full object-cover min-h-[250px]"
                />
              </div>
            </div>
          </article>
        ) : (
          <!-- Carte overlay -->
          <article
            class={`relative rounded-3xl overflow-hidden shadow-lg group ${
              item.large ? "lg:row-span-2" : ""
            }`}
          >
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent z-10"></div>

            <img
              src={item.image}
              alt={item.alt}
              class={`w-full h-full object-cover ${
                item.large ? "min-h-[600px]" : "min-h-[300px]"
              }`}
            />

            <div class="absolute top-6 left-6 z-20">
              <span
                class={`text-sm font-semibold px-4 py-2 rounded-full uppercase ${
                  item.variant === "overlay-light"
                    ? "bg-white text-gray-800"
                    : "bg-green-600 text-white"
                }`}
              >
                {item.typeLabel}
              </span>
            </div>

            <div class="absolute bottom-0 left-0 right-0 p-8 z-20 text-white">
              <h3
                class={`font-bold mb-4 ${
                  item.large ? "text-3xl" : "text-2xl"
                }`}
              >
                {item.title}
              </h3>

              {item.description && (
                <p class="text-gray-200 mb-6 text-lg">
                  {item.description}
                </p>
              )}

              <a
                href={item.link}
                class="inline-flex items-center justify-center w-12 h-12 bg-green-600 rounded-full hover:bg-green-700"
              >
                <item.icon className="w-5 h-5 text-white" />
              </a>
            </div>
          </article>
        )
      )}
    </div>

    <!-- CTA -->
    <div class="text-center">
      <a
        href="/news"
        class="inline-flex items-center gap-3 px-8 py-4 text-lg font-semibold border-2 border-green-600 text-green-600 hover:bg-green-600 hover:text-white rounded-lg"
      >
        Toutes les actualit√©s
        <HiOutlineNewspaper className="w-5 h-5" />
      </a>
    </div>

  </div>
</section>
